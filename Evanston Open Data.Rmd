---
title: "Evanston Open Data Research"
output:
  html_document:
    df_print: paged
---
This file is for exploratory research for Northwestern University's City of Evanston Open Data Contest: https://sites.northwestern.edu/lovedataweek/contest/

Deadline: Monday, April 1 @ 3:00 PM

```{r}
## Libraries
install.packages("ggmap")
install.packages("leaflet")
install.packages("leaflet.extras")


library(ggplot2)
library(ggmap)
library(tidyverse)
library(leaflet)
library(leaflet.extras)
library(htmlwidgets)
```


## Traffic Stops 2017-2018
```{r}
traffic_data <- read.csv("https://data.cityofevanston.org/resource/bbbk-a8vu.csv?$limit=35000")
levels(data$day_of_the_week) <- c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun")
```
#### Stops by Day of Week/Race
```{r}
traffic_data %>%
  ggplot() +
  geom_bar(aes(day_of_the_week)) +
  facet_wrap(~race)
```
#### Stops by Race/Beat
```{r}
traffic_data %>%
  ggplot() +
  geom_bar(aes(race)) +
  facet_wrap(~police_beat)
```
## Evanston Arrests
```{r}
arrest_data <- read.csv("https://data.cityofevanston.org/resource/jwmg-4gbx.csv")

arrest_data$loc <- as.character(arrest_data$location)

arrest_data <- arrest_data %>%
  drop_na(loc)

arrest_data$loc <- arrest_data$loc %>%
  substring(8)

arrest_data$loc <- arrest_data$loc %>%
  str_sub(1, str_length(arrest_data$loc)-1)

arrest_data_lonlat <- arrest_data %>%
  separate(col = loc, c("lon", "lat"), sep = " ")

arrest_data_lonlat$lon <- as.numeric(arrest_data_lonlat$lon)
arrest_data_lonlat$lat <- as.numeric(arrest_data_lonlat$lat)

arrest_data_lonlat <- arrest_data_lonlat %>%
  drop_na(lat)

```

## Mapping Arrests in Evanston
This is a map of arrests made in Evanston.
```{r}
leaflet() %>%
  addCircleMarkers(lng=arrest_data_lonlat$lon, lat=arrest_data_lonlat$lat, popup = arrest_data_lonlat$arrest_type) %>%
  addProviderTiles(providers$CartoDB.Positron)
```

This is a heatmap of arrests made in Evanston.
```{r}
leaflet(arrest_data_lonlat) %>% 
  addProviderTiles(providers$CartoDB.DarkMatter) %>%
  addHeatmap(lng = ~lon, lat = ~lat,
             blur = 30, max = 0.05, radius = 15)
```

##All Evanston Police Activity
```{r}
pdata <- read.csv("https://data.cityofevanston.org/resource/t5g5-xgby.csv?$limit=200000")

pdata$location <- as.character(pdata$location)

pdata <- pdata %>%
  filter(location != "")

pdata$loc <- pdata$location

pdata$loc <- pdata$loc %>%
  substring(8)

pdata$loc <- pdata$loc %>%
  str_sub(1, str_length(pdata$loc)-1)

pdata <- pdata %>%
  separate(col = loc, c("lon", "lat"), sep = " ")

pdata$lon <- as.numeric(pdata$lon)
pdata$lat <- as.numeric(pdata$lat)
```
This is a heatmap of all police activity in Evanston.
```{r}
leaflet(pdata) %>% 
  addProviderTiles(providers$CartoDB.DarkMatter) %>%
  addHeatmap(lng = ~lon, lat = ~lat,
             blur = 20, radius = 8)
```